{% extends 'base/base-c.html' %}

{% block main %}
    <div class="pages-hero">
        <div class="container">
            <div class="pages-title">
                <h1>Queries</h1>
                <div class="page-nav">
                    <p><a href="#">Home</a> &nbsp; | &nbsp; <a href="#">Queries</a></p>
                </div>
            </div>
        </div>  
    </div>

    <div class="container mt-5 mb-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h3>Expert Q&A Forum</h3>
                <p style="color: #666;">Get answers from agricultural experts</p>
            </div>
            {% if session['name'] %}
                <a href="{{ url_for('crop.former_queries') }}" class="btn button"><i class="fas fa-plus"></i> Ask a Question</a>
            {% else %}
                <a href="{{ url_for('auth.login') }}" class="btn button"><i class="fas fa-sign-in-alt"></i> Login to Ask</a>
            {% endif %}
        </div>
        
        <div class="row mb-4">
            <div class="col-md-12">
                <div class="input-group">
                    <input type="text" id="searchQuery" class="form-control" placeholder="Search queries..." onkeyup="filterQueries()">
                    <div class="input-group-append">
                        <span class="input-group-text" style="background: #EEC344; border: none;">
                            <i class="fas fa-search" style="color: white;"></i>
                        </span>
                    </div>
                </div>
            </div>
        </div>
        <div class="content-blogs">
            <div class="row hover-effects image-hover">

                {% for query in complete_queries %}
                    <div class="col-md-6 query-card" data-aos="fade-up" data-query-text="{{ query[0].text|lower }}">
                        <div class="blog-thumbnail" style="border: 2px solid #EEC344; border-radius: 10px; overflow: hidden; transition: transform 0.3s;">
                            <figure class="bt-img" style="margin: 0; position: relative;">
                                <a href="/queries-details?qid={{ query[0].id }}">
                                    <img style="height: 300px; width: 100%; object-fit: cover;" src="/{{ query[0].img_url }}" alt="Query Image">
                                </a>
                                <div style="position: absolute; top: 10px; right: 10px; background: #EEC344; color: white; padding: 5px 15px; border-radius: 20px;">
                                    <i class="fas fa-comments"></i> {{ query[0].answers|length }} Answers
                                </div>
                            </figure>
                            <div class="bt-caption" style="padding: 20px;">
                                <div class="bt-details" style="margin-bottom: 10px;">
                                    <p style="color: #666;"><i class="far fa-calendar"></i> {{ query[0].time.strftime('%B %d, %Y') }}</p>
                                </div>
                                <h4 style="min-height: 60px;">
                                    <a href="/queries-details?qid={{ query[0].id }}" style="color: #333;">{{ query[0].text }}</a>
                                </h4>
                                <hr class="bt-separator">
                                <div class="author">
                                    <div class="media"> 
                                        <div class="mr-3" style="width: 40px; height: 40px; background: #EEC344; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                            <i class="fas fa-user" style="color: white;"></i>
                                        </div>
                                        <div class="media-body"> 
                                            <h5 class="mt-0">{{ query[1].name }}</h5> 
                                            <p style="color: #666; margin: 0;"><i class="fas fa-seedling"></i> Farmer</p>
                                        </div> 
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <a href="/queries-details?qid={{ query[0].id }}" class="btn btn-sm button">View Details <i class="fas fa-arrow-right"></i></a>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}

            </div>
        </div>
        
        {% if complete_queries|length == 0 %}
            <div class="alert alert-info text-center" style="margin-top: 50px;">
                <i class="fas fa-info-circle" style="font-size: 48px; color: #EEC344;"></i>
                <h4 class="mt-3">No Queries Yet</h4>
                <p>Be the first to ask a question!</p>
                <a href="{{ url_for('crop.former_queries') }}" class="btn button">Ask Your First Question</a>
            </div>
        {% endif %}
    </div>
    
    <script>
        function filterQueries() {
            const searchTerm = document.getElementById('searchQuery').value.toLowerCase();
            const cards = document.querySelectorAll('.query-card');
            
            cards.forEach(card => {
                const queryText = card.getAttribute('data-query-text');
                if (queryText.includes(searchTerm)) {
                    card.style.display = '';
                } else {
                    card.style.display = 'none';
                }
            });
        }
        
        // Add hover effect to cards
        document.addEventListener('DOMContentLoaded', function() {
            const cards = document.querySelectorAll('.blog-thumbnail');
            cards.forEach(card => {
                card.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-5px)';
                    this.style.boxShadow = '0 10px 20px rgba(0,0,0,0.2)';
                });
                card.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0)';
                    this.style.boxShadow = 'none';
                });
            });
        });
    </script>
{% endblock main %}