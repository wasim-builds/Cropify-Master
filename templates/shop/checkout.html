{% extends 'base/base-c.html' %}

{% block main %}
    <div class="pages-hero">
        <div class="container">
            <div class="pages-title">
                <h1>Checkout</h1>
                <div class="page-nav">
                    <p><a href="{{ url_for('main.index') }}">Home</a> &nbsp; | &nbsp; <a href="{{ url_for('shop.all_products') }}">Marketplace</a> &nbsp; | &nbsp; <a href="#">Checkout</a></p>
                </div>
            </div>
        </div>  
    </div>

    <div class="wrapper-form bg-light">
        <div class="container py-5">
            {% include 'includes/alerts.html' %}
            
            <div class="row">
                <!-- ORDER FORM -->
                <div class="col-lg-7">
                    <div class="card border-0 shadow-sm" style="border-radius: 15px;">
                        <div class="card-body p-4">
                            <h4 class="mb-4" style="font-weight: 600;">
                                <i class="fas fa-shipping-fast"></i> Shipping Information
                            </h4>
                            
                            <form action="/buy-product" method="POST">
                                <input type="hidden" name="pid" value="{{ product.id }}">
                                
                                <div class="mb-3">
                                    <label class="form-label" style="font-weight: 600;">Quantity</label>
                                    <input type="number" name="quantity" class="form-control" 
                                           min="1" max="{{ product.stock }}" value="1" 
                                           id="quantity" onchange="updateTotal()" required>
                                    <small class="text-muted">Maximum {{ product.stock }} units available</small>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label" style="font-weight: 600;">
                                        <i class="fas fa-map-marker-alt"></i> Delivery Address
                                    </label>
                                    <textarea name="address" class="form-control" rows="3" 
                                              placeholder="Enter your complete delivery address" required></textarea>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label" style="font-weight: 600;">
                                        <i class="fas fa-phone"></i> Contact Phone
                                    </label>
                                    <input type="tel" name="phone" class="form-control" 
                                           placeholder="Enter your phone number" 
                                           pattern="[0-9]{10}" required>
                                    <small class="text-muted">10 digit mobile number</small>
                                </div>

                                <div class="d-flex gap-3 mt-4">
                                    <button type="submit" class="btn button btn-lg" style="flex: 1;">
                                        <i class="fas fa-check"></i> Place Order
                                    </button>
                                    <a href="/product-details?pid={{ product.id }}" class="btn btn-outline-secondary btn-lg">
                                        <i class="fas fa-times"></i> Cancel
                                    </a>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- ORDER SUMMARY -->
                <div class="col-lg-5">
                    <div class="card border-0 shadow-sm" style="border-radius: 15px;">
                        <div class="card-body p-4">
                            <h4 class="mb-4" style="font-weight: 600;">
                                <i class="fas fa-shopping-bag"></i> Order Summary
                            </h4>

                            <!-- Product Preview -->
                            <div class="d-flex mb-4">
                                <img src="/{{ product.img_url }}" alt="{{ product.name }}" 
                                     style="width: 100px; height: 100px; object-fit: cover; border-radius: 10px;">
                                <div class="ms-3">
                                    <h6 style="font-weight: 600; margin-bottom: 5px;">{{ product.name }}</h6>
                                    <p style="color: #666; font-size: 14px; margin: 0;">{{ product.category }}</p>
                                    <span class="badge badge-success mt-2">In Stock</span>
                                </div>
                            </div>

                            <hr>

                            <!-- Price Breakdown -->
                            <table class="table table-borderless mb-3">
                                <tr>
                                    <td style="color: #666;">Price per unit:</td>
                                    <td class="text-end" style="font-weight: 600;">₹{{ product.price }}</td>
                                </tr>
                                <tr>
                                    <td style="color: #666;">Quantity:</td>
                                    <td class="text-end" style="font-weight: 600;"><span id="displayQty">1</span> units</td>
                                </tr>
                                <tr>
                                    <td style="color: #666;">Subtotal:</td>
                                    <td class="text-end" style="font-weight: 600;">₹<span id="subtotal">{{ product.price }}</span></td>
                                </tr>
                                <tr>
                                    <td style="color: #666;">Delivery Charges:</td>
                                    <td class="text-end" style="font-weight: 600; color: green;">FREE</td>
                                </tr>
                                <tr style="border-top: 2px solid #EEC344;">
                                    <td style="font-size: 18px; font-weight: 600;">Total:</td>
                                    <td class="text-end" style="font-size: 24px; font-weight: 700; color: #EEC344;">
                                        ₹<span id="total">{{ product.price }}</span>
                                    </td>
                                </tr>
                            </table>

                            <div class="alert alert-info" style="background: #e7f3ff; border: none;">
                                <i class="fas fa-info-circle"></i> Cash on Delivery available
                            </div>
                        </div>
                    </div>

                    <!-- Security Info -->
                    <div class="mt-3 text-center">
                        <p style="color: #666; font-size: 14px;">
                            <i class="fas fa-shield-alt" style="color: green;"></i> 
                            Your transaction is secure
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function updateTotal() {
            const quantity = parseInt(document.getElementById('quantity').value) || 1;
            const pricePerUnit = {{ product.price }};
            const subtotal = quantity * pricePerUnit;
            
            document.getElementById('displayQty').textContent = quantity;
            document.getElementById('subtotal').textContent = subtotal;
            document.getElementById('total').textContent = subtotal;
        }
    </script>
{% endblock main %}
